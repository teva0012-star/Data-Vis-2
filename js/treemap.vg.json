{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Treemap of GDP by Continent and Country (Top 20 for 2022)",
  "width": 960,
  "height": 600,
  "autosize": "none",

  "data": {
    "url": "https://raw.githubusercontent.com/teva0012-star/Employment_data/refs/heads/main/Employment_Unemployment_GDP_data.csv",
    "format": {
      "type": "csv"
    }
  },

  "transform": [
    {
      "filter": "datum.Year == 2022"  // Filter for 2022 data
    },
    {
      "window": [
        {
          "op": "rank",
          "field": "GDP (USD)",
          "as": "rank"
        }
      ],
      "sort": [
        {"field": "GDP (USD)", "order": "descending"}
      ]
    },
    {
      "filter": "datum.rank <= 20"  // Show only the top 20 countries by GDP
    },
    {
      "type": "stratify",
      "key": "Country",
      "parentKey": "Continent"
    },
    {
      "type": "treemap",
      "field": "GDP (USD)",
      "sort": {"field": "GDP (USD)"},
      "round": true,
      "method": "squarify",  // Using squarify method for better visual appearance
      "size": [{"signal": "width"}, {"signal": "height"}]
    }
  ],

  "scales": [
    {
      "name": "color",
      "type": "quantitative",
      "domain": {"data": "tree", "field": "GDP (USD)"},
      "range": ["#e6550d", "#fd8d3c", "#fdae6b", "#fdd0a2", "#31a354", "#74c476", "#a1d99b"],
      "legend": {
        "title": "GDP (USD)"
      }
    }
  ],

  "marks": [
    {
      "type": "rect",
      "from": {"data": "tree"},
      "encode": {
        "enter": {
          "fill": {"scale": "color", "field": "GDP (USD)"},
          "stroke": {"value": "#fff"},
          "strokeWidth": {"value": 1}
        },
        "update": {
          "x": {"field": "x0"},
          "y": {"field": "y0"},
          "x2": {"field": "x1"},
          "y2": {"field": "y1"}
        }
      }
    },
    {
      "type": "text",
      "from": {"data": "tree"},
      "encode": {
        "enter": {
          "font": {"value": "Helvetica Neue, Arial"},
          "align": {"value": "center"},
          "baseline": {"value": "middle"},
          "fill": {"value": "#fff"},
          "text": {"field": "Country"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"}
        },
        "update": {
          "x": {"signal": "0.5 * (datum.x0 + datum.x1)"},
          "y": {"signal": "0.5 * (datum.y0 + datum.y1)"}
        }
      }
    }
  ],

  "config": {
    "view": {
      "stroke": "transparent"
    }
  }
}
